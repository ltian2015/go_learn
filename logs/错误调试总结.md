# OpenTelemetry + Jaeger 遥测排查总结

本次排查主要围绕 OpenTelemetry 遥测数据无法在 Jaeger UI 中显示的问题，核心原因可归结为以下几点：

## 核心错误与修正

1.  **Docker CLI 环境问题** (`docker-credential-desktop: executable file not found in $PATH` / `exec format error`)
    *   **问题表现：** `docker version` 命令无法运行，或 `docker-compose up -d` 提示找不到 `docker-credential-desktop` 或 `exec format error`。
    *   **日志观察：** 终端输出的错误信息直接指向 `docker-credential-desktop` 文件不存在或执行格式错误。
    *   **修正方法：** **彻底卸载旧版 Docker Desktop，并从官方网站下载并安装最新且适用于 Apple Silicon (ARM64) 架构的 Docker Desktop 版本。** 这是解决 `exec format error` 等底层兼容性问题的唯一可靠方法。

2.  **`docker-compose.yaml` 文件 YAML 语法错误** (`yaml: line X: did not find expected key`)
    *   **问题表现：** 运行 `docker-compose up -d` 或 `docker-compose down` 时，提示 YAML 文件在特定行号（例如 `line 16`）存在语法错误。
    *   **日志观察：** `docker-compose` 命令的输出会明确指出 YAML 文件的错误行号和大致原因（如 `did not find expected key`），通常是缩进或结构问题。
    *   **修正方法：** 根据错误提示检查 `docker-compose.yaml` 文件中对应行及其周围的缩进和键值对结构，确保其符合 YAML 规范。

3.  **OpenTelemetry Collector 配置错误** (`'exporters' unknown type: "jaeger"` / `telemetry type is not supported`)
    *   **问题表现：** Jaeger UI 中看不到服务追踪；或 `docker-compose up -d` 看起来成功，但 Collector 容器内部日志显示配置错误。
    *   **日志观察：** 运行 `docker logs logs-otel-collector-1` 查看 Collector 容器日志。
        *   若出现 `unknown type: "jaeger" for id: "jaeger"`：这表明当前 Collector 镜像版本不识别 `jaeger` 导出器。
        *   若出现 `failed to create "jaeger" exporter for data type "logs": telemetry type is not supported`：这明确指出 `jaeger` 导出器不支持处理日志（`logs`）类型的数据。
    *   **修正方法：**
        *   **对于 `unknown type`：** 修改 `docker-compose.yaml` 中 `otel-collector` 的 `image` 为一个已知包含 Jaeger 导出器的稳定版本，例如 `otel/opentelemetry-collector-contrib:0.80.0`。避免使用 `latest` 标签，因为它可能不包含所有 `contrib` 扩展。
        *   **对于 `telemetry type is not supported`：** 修改 `otel-collector-config.yaml`，从 `logs` 管道的 `exporters` 中移除 `jaeger`，因为 Jaeger 主要用于追踪，不直接作为日志的通用导出器。将日志导出到 `logging` (Collector 控制台) 或其他专门的日志后端（如 Loki、Elasticsearch 等）。

通过上述步骤，我们逐步排除了环境、配置和兼容性问题，最终成功实现了遥测数据的可视化。
